function Resource(e,t,s){for(var r in e)e.hasOwnProperty(r)&&(this[r]=e[r]);this.webSocketUrl=t,s&&(this[s]=function(){return new Entangled(this.webSocketUrl+"/"+this.id+"/"+s)})}function Resources(e,t,s){this.all=[];for(var r=0;r<e.length;r++){var o=new Resource(e[r],t,s);this.all.push(o)}}function Entangled(e){this.webSocketUrl=e}Resource.prototype.$save=function(e){if(this.id){var t=new WebSocket(this.webSocketUrl+"/"+this.id+"/update");t.onopen=function(){t.send(JSON.stringify(this))}.bind(this),t.onmessage=function(t){if(t.data){var s=JSON.parse(t.data);if(s.resource)for(key in s.resource)this[key]=s.resource[key]}this[this.hasMany]=new Entangled(this.webSocketUrl+"/"+this.id+"/"+this.hasMany),e&&e(this)}.bind(this)}else{var t=new WebSocket(this.webSocketUrl+"/create");t.onopen=function(){t.send(JSON.stringify(this))}.bind(this),t.onmessage=function(t){if(t.data){var s=JSON.parse(t.data);if(s.resource)for(key in s.resource)this[key]=s.resource[key]}e&&e(this)}.bind(this)}},Resource.prototype.$update=function(e,t){for(var s in e)e.hasOwnProperty(s)&&(this[s]=e[s]);this.$save(t)},Resource.prototype.$destroy=function(e){var t=new WebSocket(this.webSocketUrl+"/"+this.id+"/destroy");t.onopen=function(){t.send(null)},t.onmessage=function(t){if(t.data){var s=JSON.parse(t.data);if(s.resource)for(key in s.resource)this[key]=s.resource[key]}e&&e(this)}.bind(this)},Resource.prototype.$valid=function(){return!(this.errors&&Object.keys(this.errors).length)},Resource.prototype.$invalid=function(){return!this.$valid()},Resource.prototype.$persisted=function(){return!!this.id},Entangled.prototype.hasMany=function(e){this.hasMany=e},Entangled.prototype["new"]=function(e){return new Resource(e,this.webSocketUrl,this.hasMany)},Entangled.prototype.all=function(e){var t=new WebSocket(this.webSocketUrl);t.onmessage=function(s){if(s.data.length){var r=JSON.parse(s.data);if(r.resources)this.resources=new Resources(r.resources,t.url,this.hasMany);else if(r.action)if("create"===r.action)this.resources.all.push(new Resource(r.resource,t.url,this.hasMany));else if("update"===r.action){for(var o,n=0;n<this.resources.all.length;n++)this.resources.all[n].id===r.resource.id&&(o=n);this.resources.all[o]=new Resource(r.resource,t.url,this.hasMany)}else if("destroy"===r.action){for(var o,n=0;n<this.resources.all.length;n++)this.resources.all[n].id===r.resource.id&&(o=n);this.resources.all.splice(o,1)}else console.log("Something else other than CRUD happened..."),console.log(r)}e(this.resources.all)}.bind(this)},Entangled.prototype.create=function(e,t){var s=this["new"](e);s.$save(t)},Entangled.prototype.find=function(e,t){var s=this.webSocketUrl,r=new WebSocket(s+"/"+e);r.onmessage=function(e){if(e.data.length){var r=JSON.parse(e.data);r.resource&&!r.action?this.resource=new Resource(r.resource,s,this.hasMany):r.action?"update"===r.action?this.resource=new Resource(r.resource,s,this.hasMany):"destroy"===r.action&&(this.resource=void 0):(console.log("Something else other than CRUD happened..."),console.log(r))}t(this.resource)}.bind(this)};
